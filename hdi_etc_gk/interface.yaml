--- !Range1d:
    ref: "snr_xrange"
    start: 100
    end: 2300
    bounds: (120, 2300)

--- !Range1d:
    ref: "sed_xrange"
    start: 100
    end: 2300
    bounds: (120, 2300)

--- !Range1d:
    ref: "snr_yrange"
    start: 0
    end: 40
    bounds: (0, 40)

--- !Range1d:
    ref: "sed_yrange"
    start: 35
    end: 21
    bounds: (35, 21)

--- !HoverTool:
    ref: "hover"
    point_policy: "snap_to_data"
    tooltips: {hover_tooltip}

--- !ColumnDataSource:
    ref: "source_blue"
    data:
        x: {camera}.pivotwave[2:-3]
        y: {snr}[2:-3]
        desc: {camera}.bandnames[2:-3]

--- !ColumnDataSource:
    ref: "source_orange"
    data:
        x: {camera}.pivotwave[:2]
        y: {snr}[:2]
        desc: {camera}.bandnames[:2]

--- !ColumnDataSource:
    ref: "source_red"
    data:
        x: {camera}.pivotwave[-3:]
        y: {snr}[-3:]
        desc: {camera}.bandnames[-3:]

--- !ColumnDataSource:
    ref: "spectrum_template"
    x: {template_spectrum}.wave
    y: {template_spectrum}.flux

--- !ColumnDataSource:
    ref: "dummy_source"
    data:
        value: []
    on_data: {controller}
    
--- !CustomJS
    ref: "callback"

--- !!Document:
    --- !row:
        --- !Tabs:
            --- !Panel:
                title: 'Controls'
                --- !WidgetBox:
                    --- !Slider:
                        ref: "ap_slider"
                        title: "Aperture (meters)"
                        value: 12.
                        range: [2.0, 20.0, 1.0]
                        tags: [4, 5, 6, 6]
                        callback: {{callback}}
                    --- !Slider:
                        ref: "exp_slider"
                        title: "Exptime (hours)"
                        value: 1.0
                        range: [0.1, 10.0, 0.1]
                        callback: {{callback}}
                    --- !Slider:
                        ref: "mag_slider"
                        title: "V Magnitude (AB)"
                        value: 30.0
                        range: [20.0, 35.0, 0.1]
                        callback: {{callback}}
                    --- !Select:
                        ref: "template_select"
                        title: "Template Spectrum"
                        value: "Flat (AB)"
                        options: {template_options}
                        on_value: {controller}
            --- !Panel:
                title: 'Info'
                --- !Div:
                    text: {help_text}
        --- !Tabs:
            --- !Panel:
                title: "SNR"
                width: 800
                --- !Figure:
                    x_range: {{snr_xrange}}
                    y_range: {{snr_yrange}}
                    yaxis_label: 'SNR'
                    xaxis_label: 'Wavelength (nm)'
                    add_tool: {{hover}}
                    text:
                        loc: [5500, 20]
                        text: ['V']
                        text_align: 'center'
                        text_color: 'red'
                    --- !Line:
                        source: {{source_blue}}
                        line_color: 'blue'
                    --- !Circle:
                        source: {{source_blue}}
                        line_color: 'blue'
                        size: 10
                    --- !Line:
                        source: {{source_orange}}
                        line_color: 'orange'
                    --- !Circle:
                        source: {{source_orange}}
                        line_color: 'orange'
                        size: 8
                    --- !Line:
                        source: {{source_red}}
                        line_color: 'red'
                    --- !Circle:
                        source: {{source_red}}
                        line_color: 'red'
                        size: 8
            --- !Panel:
                title: 'SED'
                width: 800
                --- !Figure:
                    x_range: {{sed_xrange}}
                    y_range: {{sed_yrange}}
                    yaxis_label: 'AB Mag'
                    xaxis_label: 'Wavelength (nm)'
                    --- !Line:
                        source: {{spectrum_template}}
                        line_color: 'orange'